name: Update ASCII in README

on:
  schedule:
    - cron: "0 */6 * * *"   # run every 6 hours
  workflow_dispatch:         # allow manual trigger

jobs:
  ascii-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install figlet
        run: sudo apt-get update && sudo apt-get install -y figlet

      - name: Pick random font and message
        run: |
          # Fonts list (expandable)
          FONTS=("banner" "block" "bubble" "digital" "ivrit" "lean" "mini" "script" "shadow" "slant" "small" "standard")

          # Pick random font
          FONT=${FONTS[$RANDOM % ${#FONTS[@]}]}

          # Pick random message from messages.txt
          MSG=$(shuf -n 1 messages.txt)

          echo "FONT=$FONT" >> $GITHUB_ENV
          echo "MSG=$MSG" >> $GITHUB_ENV

      - name: Generate ASCII
        run: |
          echo "🎨 Using font: $FONT"
          echo "📝 Message: $MSG"

          {
            echo "Font: \`$FONT\`"
            echo "Message: \`$MSG\`"
            echo '```text'
            figlet -f "$FONT" "$MSG"
            echo '```'
          } > ascii.txt

      - name: Update README.md
        run: |
          # Replace content between markers with the new ASCII block
          awk 'BEGIN{p=1} /<!--ascii-start-->/ {print; system("cat ascii.txt"); p=0} /<!--ascii-end-->/ {p=1} p' README.md > tmp && mv tmp README.md

      - name: Commit and Push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add README.md
          git commit -m "chore: update ASCII art [skip ci]" || echo "No changes to commit"
          git push
