name: ASCII

on:
  schedule:
    - cron: "0 */6 * * *"   # run every 6 hours
  workflow_dispatch:

permissions:
  contents: write   # ðŸ‘ˆ allow the workflow to push changes
  
jobs:
  ascii-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install figlet
        run: sudo apt-get update && sudo apt-get install -y figlet

      - name: Pick preview message
        run: |
          PREVIEW_MSG=$(shuf -n 1 messages.txt)
          echo "PREVIEW_MSG=$PREVIEW_MSG" >> $GITHUB_ENV

      - name: Preview all available fonts
        run: |
          echo "ðŸ“œ Available figlet fonts (showing first 20):"
          echo "-------------------------------------------"
          for f in $(showfigfonts | awk '{print $1}' | head -n 20); do
            echo
            echo ">>> Font: $f"
            figlet -f "$f" "$PREVIEW_MSG" || echo "âš ï¸ Skipped font: $f"
          done
          echo "-------------------------------------------"
          echo "Scroll through this log to decide which fonts to keep in your curated list."

      - name: Pick random font and message
        run: |
          # Curated font list (edit this after previewing)
          FONTS=("standard" "slant" "banner" "block" "shadow" "lean" "mini" "small" "digital" "bubble" "script")

          FONT=${FONTS[$RANDOM % ${#FONTS[@]}]}
          MSG=$(shuf -n 1 messages.txt)

          echo "FONT=$FONT" >> $GITHUB_ENV
          echo "MSG=$MSG" >> $GITHUB_ENV

      - name: Generate ASCII
        run: |
          echo "ðŸŽ¨ Using font: $FONT"
          echo "ðŸ“ Message: $MSG"

          {
            echo "Font: \`$FONT\`"
            echo "Message: \`$MSG\`"
            echo '```text'
            figlet -f "$FONT" "$MSG"
            echo '```'
          } > ascii.txt

      - name: Update README.md
        run: |
          awk 'BEGIN{p=1} /<!--ascii-start-->/ {print; system("cat ascii.txt"); p=0} /<!--ascii-end-->/ {p=1} p' README.md > tmp && mv tmp README.md

      - name: Commit and Push
        run: |
          git config user.name "github-actions"
          git config user.email "actions@github.com"
          git add README.md
          git commit -m "chore: update ASCII art [skip ci]" || echo "No changes to commit"
          git push
