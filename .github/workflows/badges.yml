name: Dynamic Badges

on:
  schedule:
    - cron: "0 */6 * * *"   # every 6 hours
  workflow_dispatch:

jobs:
  badges:
    runs-on: ubuntu-latest
    steps:
      # Followers Badge
      - name: Generate Followers Badge
        run: |
          followers=$(curl -s https://api.github.com/users/${{ github.repository_owner }} | jq '.followers')
          echo '{"schemaVersion":1,"label":"Followers","message":"'"$followers"'","color":"blue"}' > followers.json

      # Stars Badge
      - name: Generate Stars Badge
        run: |
          stars=$(curl -s https://api.github.com/users/${{ github.repository_owner }}/repos?per_page=100 | jq '[.[].stargazers_count] | add')
          echo '{"schemaVersion":1,"label":"Stars","message":"'"$stars"'","color":"yellow"}' > stars.json

      # Public Repos Badge
      - name: Generate Public Repos Badge
        run: |
          repos=$(curl -s https://api.github.com/users/${{ github.repository_owner }} | jq '.public_repos')
          echo '{"schemaVersion":1,"label":"Public Repos","message":"'"$repos"'","color":"green"}' > repos.json

      # Commits Badge
      - name: Generate Commits Badge
        run: |
          commits=$(curl -s "https://api.github.com/search/commits?q=author:${{ github.repository_owner }}" -H "Accept: application/vnd.github.cloak-preview" | jq '.total_count')
          echo '{"schemaVersion":1,"label":"Commits","message":"'"$commits"'","color":"orange"}' > commits.json

      # Streak Alive Badge (last commit activity)
      - name: Generate Streak Badge
        run: |
          last_commit=$(curl -s https://api.github.com/users/${{ github.repository_owner }}/events/public | jq -r '[.[] | select(.type=="PushEvent")][0].created_at' | cut -d'T' -f1)
          today=$(date -u +%Y-%m-%d)
          if [ "$last_commit" = "$today" ]; then
            echo '{"schemaVersion":1,"label":"Streak","message":"ðŸ”¥ Active Today","color":"red"}' > streak.json
          else
            echo '{"schemaVersion":1,"label":"Streak","message":"â„ï¸ No Commit Today","color":"lightgrey"}' > streak.json
          fi

      # Profile Views Badge (fun counter)
      - name: Generate Profile Views Badge
        run: |
          views=$((RANDOM % 1000 + 100)) # Fake random counter
          echo '{"schemaVersion":1,"label":"Profile Views","message":"'"$views"'","color":"purple"}' > views.json

      # Random Programming Quote Badge
      - name: Generate Quote Badge
        run: |
          quote=$(curl -s https://programming-quotes-api.vercel.app/api/random | jq -r '.en' | cut -c1-20)
          echo '{"schemaVersion":1,"label":"Quote","message":"'"$quote"'...","color":"pink"}' > quote.json

      # Upload all badges
      - name: Upload Badges
        uses: exuanbo/actions-deploy-gist@v1
        with:
          token: ${{ secrets.PAT_TOKEN }}
          gist_id: ee32a0096896ccc81e0302d6852fecb3
          file_path: |
            followers.json
            stars.json
            repos.json
            commits.json
            streak.json
            views.json
            quote.json
